<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproductor Musical - Evento</title>
<style>
  body {
    margin:0;
    font-family: 'Arial', sans-serif;
    background: #121212;
    color: #eee;
  }
  header {
    background: #1f1f1f;
    padding: 10px 20px;
    font-size: 1.5em;
    text-align: center;
    letter-spacing: 1px;
    border-bottom: 2px solid #ff0066;
  }
  main {
    display: flex;
    flex-direction: row;
    padding: 20px;
    gap: 20px;
  }
  .menu {
    width: 250px;
    background: #1f1f1f;
    padding: 10px;
    border-radius: 8px;
  }
  .menu select {
    width: 100%;
    padding: 5px;
    margin-bottom: 10px;
    background: #121212;
    color: #eee;
    border: 1px solid #ff0066;
    border-radius: 4px;
  }
  .menu button {
    width: 100%;
    padding: 8px;
    margin-top: 10px;
    background: #ff0066;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .menu button:hover {
    background: #ff3388;
  }
  .modal {
    display: none;
    position: fixed;
    top:0;
    left:0;
    width: 100%;
    height:100%;
    background: rgba(0,0,0,0.9);
    justify-content: center;
    align-items: center;
    z-index: 1000;
    flex-direction: column;
  }
  .modal img {
    max-width: 300px;
    margin-bottom: 10px;
    border: 3px solid #ff0066;
  }
  .modal span {
    font-size: 1.2em;
  }
  .modal button {
    margin-top: 15px;
    padding: 8px 16px;
    background: #ff0066;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: #fff;
  }
  footer {
    position: fixed;
    bottom:0;
    left:0;
    width:100%;
    background: #1f1f1f;
    display:flex;
    align-items:center;
    padding:10px 20px;
    gap: 10px;
    border-top: 2px solid #ff0066;
  }
  footer button {
    background: #ff0066;
    border:none;
    color:#fff;
    padding:5px 10px;
    border-radius:4px;
    cursor:pointer;
  }
  footer button:hover {
    background: #ff3388;
  }
  #progress {
    flex:1;
  }
</style>
</head>
<body>

<header>🎵 Evento Musical</header>

<main>
  <div class="menu">
    <select id="artistaSelect">
      <option value="">Selecciona Artista</option>
    </select>
    <select id="albumSelect" disabled>
      <option value="">Selecciona Álbum</option>
    </select>
    <select id="cancionSelect" disabled>
      <option value="">Selecciona Canción</option>
    </select>
    <button id="playBtn" disabled>Play</button>
  </div>
</main>

<div class="modal" id="modal">
  <img id="modalPortada" src="" alt="Portada">
  <span id="modalCancion"></span>
  <button id="closeModal">Cerrar</button>
</div>

<footer>
  <button id="footerPlay">Play</button>
  <button id="footerPause">Pause</button>
  <button id="footerStop">Stop</button>
  <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
  <input type="range" id="progress" min="0" max="100" value="0">
</footer>

<audio id="audio"></audio>

<script>
const DATA_URL = "https://script.google.com/macros/s/AKfycbyI-sKGQsR2n0L6sEh2W6UAqfRMo48Caga11Ff5QXIp7UWl2eiuE1ehEqqCOnoVbRrLMQ/exec";

let songs = [];
let currentSong = null;

const artistaSelect = document.getElementById("artistaSelect");
const albumSelect = document.getElementById("albumSelect");
const cancionSelect = document.getElementById("cancionSelect");
const playBtn = document.getElementById("playBtn");
const modal = document.getElementById("modal");
const modalPortada = document.getElementById("modalPortada");
const modalCancion = document.getElementById("modalCancion");
const closeModal = document.getElementById("closeModal");
const audio = document.getElementById("audio");
const footerPlay = document.getElementById("footerPlay");
const footerPause = document.getElementById("footerPause");
const footerStop = document.getElementById("footerStop");
const progress = document.getElementById("progress");
const currentTime = document.getElementById("currentTime");
const duration = document.getElementById("duration");

// Cargar canciones desde Sheet
fetch(DATA_URL)
  .then(res => res.json())
  .then(data => {
    songs = data.map(row => ({
      artista: row.artista.trim(),
      album: row.album.trim(),
      cancion: row.cancion.trim(),
      mp3: row.mp3.trim(),
      portada: row.portada.trim()
    }));

    const artistas = [...new Set(songs.map(s => s.artista))];
    artistas.forEach(a => {
      const opt = document.createElement("option");
      opt.value = a;
      opt.textContent = a;
      artistaSelect.appendChild(opt);
    });
  });

// Eventos de selección
artistaSelect.addEventListener("change", () => {
  albumSelect.innerHTML = '<option value="">Selecciona Álbum</option>';
  cancionSelect.innerHTML = '<option value="">Selecciona Canción</option>';
  playBtn.disabled = true;
  if(!artistaSelect.value) { albumSelect.disabled = true; cancionSelect.disabled = true; return;}
  albumSelect.disabled = false;
  const albums = [...new Set(songs.filter(s=>s.artista===artistaSelect.value).map(s=>s.album))];
  albums.forEach(a=>{
    const opt = document.createElement("option");
    opt.value = a;
    opt.textContent = a;
    albumSelect.appendChild(opt);
  });
});

albumSelect.addEventListener("change", () => {
  cancionSelect.innerHTML = '<option value="">Selecciona Canción</option>';
  playBtn.disabled = true;
  if(!albumSelect.value) { cancionSelect.disabled = true; return;}
  cancionSelect.disabled = false;
  const canciones = songs.filter(s=>s.artista===artistaSelect.value && s.album===albumSelect.value);
  canciones.forEach(c=>{
    const opt = document.createElement("option");
    opt.value = c.mp3;
    opt.textContent = c.cancion;
    opt.dataset.portada = c.portada;
    cancionSelect.appendChild(opt);
  });
});

cancionSelect.addEventListener("change", () => {
  playBtn.disabled = !cancionSelect.value;
});

playBtn.addEventListener("click", () => {
  const selected = cancionSelect.selectedOptions[0];
  if(!selected) return;
  currentSong = {
    mp3: selected.value,
    portada: selected.dataset.portada,
    nombre: selected.textContent
  };
  audio.src = encodeURI(currentSong.mp3);
  audio.play();
  modalPortada.src = encodeURI(currentSong.portada);
  modalCancion.textContent = currentSong.nombre;
  modal.style.display = "flex";
});

// Modal cerrar
closeModal.addEventListener("click", ()=> modal.style.display="none");

// Footer controls
footerPlay.addEventListener("click", ()=> audio.play());
footerPause.addEventListener("click", ()=> audio.pause());
footerStop.addEventListener("click", ()=>{
  audio.pause();
  audio.currentTime = 0;
});

// Barra de progreso
audio.addEventListener("timeupdate", ()=>{
  progress.value = (audio.currentTime/audio.duration)*100 || 0;
  currentTime.textContent = formatTime(audio.currentTime);
  duration.textContent = formatTime(audio.duration);
});

progress.addEventListener("input", ()=>{
  audio.currentTime = (progress.value/100)*audio.duration;
});

function formatTime(sec){
  if(isNaN(sec)) return "0:00";
  const m = Math.floor(sec/60);
  const s = Math.floor(sec%60);
  return m+":"+ (s<10?"0"+s:s);
}
</script>

</body>
</html>
